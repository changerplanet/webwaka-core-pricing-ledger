
WebWaka Core Pricing Logic

‚∏ª

CONTEXT (READ CAREFULLY)

You are implementing Phase 3B ‚Äî Core Pricing Logic for the WebWaka platform.

This is a CORE ENGINE MODULE.

üö´ This is NOT UI
üö´ This is NOT payments
üö´ This is NOT subscriptions
üö´ This is NOT billing execution
üö´ This is NOT persistence

This is a pure, deterministic pricing evaluation engine whose outputs will later be consumed by:
	‚Ä¢	Core Ledger
	‚Ä¢	Core Entitlements
	‚Ä¢	Core Incentives
	‚Ä¢	Suites (POS, SVM, MVM, etc.)

‚∏ª

SOURCE OF TRUTH (IMMUTABLE)

WebWaka Ecosystem Constitution v1.5+

Mandatory principles:
	‚Ä¢	Deterministic systems only
	‚Ä¢	Tenant isolation everywhere
	‚Ä¢	Nigeria-first (currency aware, but pricing itself is currency-agnostic)
	‚Ä¢	Pure functions
	‚Ä¢	No side effects
	‚Ä¢	Ledger-ready outputs
	‚Ä¢	Append-only economics (no mutation)

‚∏ª

TARGET REPOSITORY (MANDATORY)

Before doing ANYTHING ELSE:

1Ô∏è‚É£ Clone this repository fully

https://github.com/changerplanet/webwaka-core-pricing-ledger

‚ùó If the repo is not cloned successfully, STOP immediately and report.

All work must happen inside this repo.
Do NOT scaffold a new project.
Do NOT work outside the repo.

‚∏ª

OBJECTIVE

Implement the Core Pricing Engine that:
	‚Ä¢	Defines pricing plans and immutable plan versions
	‚Ä¢	Evaluates pricing deterministically
	‚Ä¢	Produces ledger-ready pricing results
	‚Ä¢	Can be reused by any suite, partner, or tenant

‚∏ª

SCOPE (LOCKED)

‚úÖ YOU MUST IMPLEMENT

1Ô∏è‚É£ Domain Models (Zod-validated)
	‚Ä¢	PricingPlan
	‚Ä¢	PricingPlanVersion (IMMUTABLE once created)
	‚Ä¢	PricingComponent (discriminated union):
	‚Ä¢	FlatFeeComponent
	‚Ä¢	UsageComponent
	‚Ä¢	SeatComponent
	‚Ä¢	TieredComponent (volume + graduated)
	‚Ä¢	TimeBoundComponent
	‚Ä¢	PricingContext
	‚Ä¢	PricingLineItem
	‚Ä¢	PricingResult

‚∏ª

2Ô∏è‚É£ Pricing Engine (PURE)

Implement:

PricingEngine.evaluate(
  planVersion: PricingPlanVersion,
  context: PricingContext
): PricingResult

Rules:
	‚Ä¢	No I/O
	‚Ä¢	No Date.now()
	‚Ä¢	No randomness
	‚Ä¢	No persistence
	‚Ä¢	Same input ‚Üí same output (always)

‚∏ª

3Ô∏è‚É£ Ledger-Ready Output (MANDATORY)

PricingResult must contain:
	‚Ä¢	currency
	‚Ä¢	totalAmount
	‚Ä¢	lineItems[]
	‚Ä¢	pricingVersionId
	‚Ä¢	tenantId
	‚Ä¢	idempotencyKey-friendly identifiers
	‚Ä¢	NO paymentId
	‚Ä¢	NO subscription state
	‚Ä¢	NO tax logic
	‚Ä¢	NO incentives logic

‚∏ª

4Ô∏è‚É£ Immutability Enforcement
	‚Ä¢	PricingPlanVersion must be immutable
	‚Ä¢	Any attempt to modify must throw or be prevented structurally

‚∏ª

üö´ STRICT EXCLUSIONS (NON-NEGOTIABLE)

DO NOT implement:
	‚Ä¢	Payments
	‚Ä¢	Subscriptions
	‚Ä¢	Coupons
	‚Ä¢	Discounts
	‚Ä¢	Taxes
	‚Ä¢	UI
	‚Ä¢	APIs
	‚Ä¢	Databases
	‚Ä¢	Feature flags
	‚Ä¢	Incentives

Violating scope = automatic failure.

‚∏ª

üß™ TESTING REQUIREMENTS (MANDATORY)

You MUST write tests proving:

1Ô∏è‚É£ Determinism

Same input evaluated 10√ó ‚Üí identical JSON output

2Ô∏è‚É£ Component correctness

Each pricing component type evaluates correctly

3Ô∏è‚É£ Immutability

PricingPlanVersion cannot be mutated

4Ô∏è‚É£ Ledger compatibility

Output can be safely passed to Core Ledger

5Ô∏è‚É£ Tenant isolation

PricingContext always enforces tenantId

‚∏ª

üõë HARD STOP CONDITION (REQUIRED TEST)

Include a test explicitly named:

‚ÄúHard Stop ‚Äî Pricing engine produces deterministic, ledger-ready output without side effects‚Äù

This test must prove:
	‚Ä¢	No side effects
	‚Ä¢	No time dependence
	‚Ä¢	No payment coupling
	‚Ä¢	Deterministic output

‚∏ª

CI / QUALITY RULES
	‚Ä¢	npm test MUST fail on failure
	‚Ä¢	npm run build MUST pass
	‚Ä¢	Coverage ‚â• 80%
	‚Ä¢	No masked commands (|| true forbidden)

‚∏ª

FINAL DELIVERABLE

When finished, produce a Completion Summary including:
	‚Ä¢	APIs implemented
	‚Ä¢	Pricing components supported
	‚Ä¢	Test count + coverage
	‚Ä¢	Proof of hard stop condition
	‚Ä¢	Final commit SHA

‚∏ª

‚õî HARD STOP

After submitting the completion report:

‚õî STOP
‚õî Do NOT proceed to Phase 3C
‚õî Await explicit authorization

‚∏ª

ACKNOWLEDGEMENT FORMAT

Reply only with:

‚ÄúPhase 3B acknowledged. Proceeding exactly as instructed.‚Äù

Then execute.
